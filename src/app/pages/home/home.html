<div class="main-container">
  <div class="navbar-container">
    <button matButton="tonal" matTooltip="{{'app.home.username-tooltip' | translate}}" (click)="openChangeUsernameDialog()">{{'app.home.greet' | translate}}, {{
      (currentUser$ | async)?.username }}</button>
    <div class="lang-logout-container">
      <button matButton="outlined" (click)="signout()"><mat-icon fontIcon="logout"></mat-icon>{{'app.home.signout' | translate}}</button>
      <app-language-selector></app-language-selector>
    </div>
  </div>
  <mat-drawer-container>
    <mat-drawer #sidenav mode="over" closed class="sidenav">
      <button matMiniFab (click)="sidenav.toggle()"><mat-icon>arrow_back</mat-icon></button>
      <mat-tab-group>
        <mat-tab label="{{'app.home.all-users-label' | translate}}">
          <mat-list>
            @for(user of allUsers$ | async; track user.id){
              <mat-list-item><button (click)="openPrivateChat(user.id)"
                  [ngClass]="user.online ? 'online-user-button' : 'offline-user-button'"
                  matButton="outlined"><mat-icon>person</mat-icon>{{user.username}}</button></mat-list-item>
              <mat-divider></mat-divider>
            }
          </mat-list>
        </mat-tab>
        <mat-tab label="{{'app.home.online-users-label' | translate}}">
          @for (user of onlineUsers$ | async; track user.id) {
          <mat-list>
            <mat-list-item><button (click)="openPrivateChat(user.id)" matButton="outlined"
                class="online-user-button"><mat-icon>person</mat-icon>{{user.username}}</button></mat-list-item>
            <mat-divider></mat-divider>
          </mat-list>
          }
        </mat-tab>
        <mat-tab label="{{'app.home.groups-label' | translate}}">
          <mat-tab-group>
            <mat-tab label="{{'app.home.public-groups-label' | translate}}">
              @for (group of publicGroups$ | async; track group.roomId) {
              <mat-list>
                <mat-list-item><button matButton="outlined" (click)="openGroup(group.roomId)"
                    [ngClass]="group.ownerId === currentUserId ? 'owned-group' : 'not-owned-group'"><mat-icon>group</mat-icon>{{group.roomName}}</button></mat-list-item>
                <mat-divider></mat-divider>
              </mat-list>
              }
              <div class="create-group-button-container">
                <button class="create-group-button" matButton="outlined" (click)="createPublicGroup()"><mat-icon>add</mat-icon>{{'app.home.public-room-add' | translate}}</button>
              </div>
            </mat-tab>
            <mat-tab label="{{'app.home.password-groups-label' | translate}}">
              @for (group of passwordGroups$ | async; track group.roomId) {
              <mat-list>
                <mat-list-item><button matButton="outlined"
                    (click)="openPasswordValidationDialog(group.roomId, group.members)"
                    [ngClass]="group.ownerId === currentUserId ? 'owned-group' : 'not-owned-group'"><mat-icon>lock</mat-icon>{{group.roomName}}</button></mat-list-item>
                <mat-divider></mat-divider>
              </mat-list>
              }
              <div class="create-group-button-container">
                <button class="create-group-button" matButton="outlined" (click)="openPasswordGroupDialog()"><mat-icon>add</mat-icon>{{'app.home.password-room-add' | translate}}</button>
              </div>
            </mat-tab>
            <mat-tab label="{{'app.home.private-groups-label' | translate}}">
              @for (group of privateGroups$ | async; track group.roomId) {
              <mat-list>
                <mat-list-item><button matButton="outlined" (click)="openGroup(group.roomId)"
                    [ngClass]="group.ownerId === currentUserId ? 'owned-group' : 'not-owned-group'"><mat-icon>shield_person</mat-icon>{{group.roomName}}</button></mat-list-item>
                <mat-divider></mat-divider>
              </mat-list>
              }
              <div class="create-group-button-container">
                <button class="create-group-button" matButton="outlined" (click)="createPrivateGroup()"><mat-icon>add</mat-icon>{{'app.home.private-room-add' | translate}}</button>
              </div>
            </mat-tab>
          </mat-tab-group>
        </mat-tab>
      </mat-tab-group>
    </mat-drawer>
    <mat-drawer-content>
      <button matMiniFab (click)="sidenav.toggle()"><mat-icon>chat</mat-icon></button>
      @if(selectedRoom$){
      <app-chat-window (closeChat)="chatCloseChildEvent()" [selectedRoom$]="selectedRoom$"
        [allUsers$]="allUsers$"></app-chat-window>
      }@else if (isLoading){
      <div class="no-chat-opened-container">
        <h2>{{'app.home.loading' | translate}}</h2>
      </div>
      }@else{
      <div class="no-chat-opened-container">
        <h2>{{'app.home.title' | translate}}</h2>
        <button (click)="sidenav.toggle()" matButton="outlined">{{'app.home.open-chatlist' | translate}}</button>
      </div>
      }
    </mat-drawer-content>
  </mat-drawer-container>
</div>